#!/usr/bin/env node

const run = require('../src/runMain');
const con = require('../src/constants');
const yargs = require('yargs');
const findUp = require('find-up');
const fs = require('fs');

const main = async () => {
    const configPath = await findUp(['.vanadrc', 'vanad.json']);
    const config = configPath ? JSON.parse(fs.readFileSync(configPath)) : {};
    const verbosityChoices = Object.keys(con.VerbosityLevel);
    const browserChoices = Object.keys(con.BrowserMode);

    const argv = yargs
        .option('verbosity', { alias: 'v', default: 'normal', choices: verbosityChoices })
        .option('browser', { alias: 'b', default: 'none', choices: browserChoices })
        .option('threads', { alias: 't', default: false })
        .option('data', { alias: 'd', default: {} })
        .option('path', { alias: '-p', default: './test/**/*.spec.js' })
        .config(config).argv;

    const cwd = process.cwd();
    run({ cwd, ...argv });
};

main();
